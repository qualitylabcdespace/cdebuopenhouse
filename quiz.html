<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quiz - ทดสอบพลังเวท</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        .question {
            margin-bottom: 20px;
        }

        .effect {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            display: none;
        }

        .fire {
            background: url('fire.gif') center center no-repeat;
            background-size: contain;
        }

        .explosion {
            background: url('explosion.gif') center center no-repeat;
            background-size: contain;
        }
    </style>
</head>

<body>
    <h2>ทดสอบพลังเวทของคุณ</h2>
    <form id="quizForm">
        <div class="question">
            <p>ถ้าได้เลือกสมาชิกเพื่ออยู่บ้านประจำกลุ่ม คุณอยากเลือกใคร?
</p>
            <label><input type="radio" name="q1" value="ไฟ" required /> ธาตุทองซาวด์</label><br />
            <label><input type="radio" name="q1" value="น้ำ" /> น้ำ</label><br />
            <label><input type="radio" name="q1" value="ลม" /> ลม</label><br />
            <label><input type="radio" name="q1" value="ดิน" /> ดิน</label>
        </div>

        <div class="question">
            <p>2. คุณอยากได้พลังเวทแบบไหน?</p>
            <label><input type="radio" name="q2" value="ระเบิด" required /> ระเบิด</label><br />
            <label><input type="radio" name="q2" value="พ่นไฟ" /> พ่นไฟ</label><br />
            <label><input type="radio" name="q2" value="ล่องหน" /> ล่องหน</label><br />
            <label><input type="radio" name="q2" value="ฟื้นฟู" /> ฟื้นฟู</label>
        </div>

        <div class="question">
            <p>3. สีที่ชอบคือ?</p>
            <label><input type="radio" name="q3" value="แดง" required /> แดง</label><br />
            <label><input type="radio" name="q3" value="น้ำเงิน" /> น้ำเงิน</label><br />
            <label><input type="radio" name="q3" value="เขียว" /> เขียว</label><br />
            <label><input type="radio" name="q3" value="ดำ" /> ดำ</label>
        </div>

        <div class="question">
            <p>4. สัตว์ที่คุณชอบคือ?</p>
            <label><input type="radio" name="q4" value="มังกร" required /> มังกร</label><br />
            <label><input type="radio" name="q4" value="นกฟีนิกซ์" /> นกฟีนิกซ์</label><br />
            <label><input type="radio" name="q4" value="ยูนิคอร์น" /> ยูนิคอร์น</label><br />
            <label><input type="radio" name="q4" value="แมว" /> แมว</label>
        </div>

        <button type="submit">ส่งคำตอบ</button>
    </form>

    <div id="effectBox" class="effect"></div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="app.js"></script>
    <script>
        const form = document.getElementById('quizForm');
        const effectBox = document.getElementById('effectBox');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // อ่านคำตอบ
            const answers = {
                q1: form.q1.value,
                q2: form.q2.value,
                q3: form.q3.value,
                q4: form.q4.value
            };

            // ดึง participantId จาก localStorage (ที่ได้จากการลงทะเบียน)
            const participantId = localStorage.getItem('participantId');
            if (!participantId) {
                alert('ไม่พบข้อมูลผู้เข้าร่วม กรุณาลงทะเบียนก่อนเล่นควิซ');
                window.location.href = 'register.html';
                return;
            }

            try {
                // บันทึกคำตอบลง Firestore
                await db.collection('participants').doc(participantId).update({
                    quizAnswers: answers,
                    quizTimestamp: new Date()
                });

                // แสดงผลพลังเวทตามคำตอบ q2
                effectBox.style.display = 'block';
                if (answers.q2 === 'ระเบิด') {
                    effectBox.className = 'effect explosion';
                } else if (answers.q2 === 'พ่นไฟ') {
                    effectBox.className = 'effect fire';
                } else {
                    effectBox.className = 'effect';
                    effectBox.textContent = 'พลังเวทของคุณพิเศษ!';
                }

                // หลังแสดงผล 3 วิ ให้ไปหน้าผลลัพธ์
                setTimeout(() => {
                    window.location.href = 'result.html';
                }, 3000);

            } catch (error) {
                alert('เกิดข้อผิดพลาดในการบันทึกคำตอบ: ' + error.message);
            }
        });
    </script>
</body>

</html>